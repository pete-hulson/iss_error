---
title: "Inclusion of ageing error and growth variability in the estimation of age composition input sample size"
author:
  - name: Peter-John F. Hulson
    institute: afscjnu
    email: pete.hulson@noaa.gov
    correspondence: true
  - name: Benjamin C. Williams
    institute: afscjnu    
institute:
  - afscjnu: Auke Bay Laboratories, Alaska Fisheries Science Center, National Marine Fisheries Service, National Oceanic and Atmospheric Administration, 17109 Point Lena Loop Rd., Juneau, AK 99801
output:
 
  bookdown::word_document2:
    toc: false
    number_sections: false
    reference_docx: styles_reference_ph_jrnl.docx
    pandoc_args:  
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
bibliography: refs.bib   
csl: canjfas.csl
header-includes:
  - \usepackage(amsmath) # for cases in equations
  - \usepackage{booktabs}
  - \usepackage{cleveref}
  - \renewcommand{\eqref}{\Cref}
  - \Crefformat{equation}{#2#1#3}
  
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, error = FALSE)
source(here::here('R', "render_toc.R"))
```

\newpage

# Abstract

Input sample size is a quantity that is used to weight composition data in stock assessment models.
Both design-based bootstrap and model-based estimators have been proposed, however, these methods to determine input sample size do not explicitly include sources of uncertainty from ageing error and growth variability that are inherent to expanded age composition data.
In this study, we evaluate the impact of including ageing error and growth variability within bootstrap methods that estimate age composition input sample size.
We find that for all the stocks evaluated the input sample size determined from bootstrap methods decreased as these addition sources of uncertainty were included (*add %increase?*), indicating that there is more uncertainty within age composition data than would be accounted for with input sample size estimates that do not include these sources of uncertainty.
*We argue that current methods to set input sample size at the number of hauls should be discontinued due to the lack of a statistically significant relationship between input sample size and the number of hauls.*
The method and results provided here allow for assessment scientist to weight age composition with input sample size that takes into account ageing error and growth variability that are implicit to any expanded age composition from either fishery-independent or fishery-dependent sources; this has not previously been investigated.

\newpage

# Introduction

Compositional information on age and length are critical data products used in statistical catch-at-age assessment (SCAA) models as they facilitate the tracking of year classes and size-structure over time to facilitate our understanding of a fish stock's population dynamics [@QuinnDeriso1999]. 
The two primary sources for age and length composition data used in SCAA models are fishery-independent and fishery-dependent. 
Fishery-independent sources typically include randomized and standardized collection of samples from hauls in a non-targeted framework.
Fishery-dependent sources are based upon collection of age and length samples, randomized at some level, but obtained from hauls targeting a specific species or fishery. 

Regardless of the source of composition data, it is commonly accepted that overdispersion of the data is inherent due to intra-haul correlation [e.g., @Pennington2000], along with other multiple sources of error [@Pennington2002; @Hulson2011; @Stewart2014]. 
The concept of realized sample size [introduced by @Mcallister1997, but using the terminology presented in @Stewart2014], a reduced sample size from the actual number of fish measured or aged, is implemented to account for increased uncertainty due to these measurement and observation errors. 
The realized sample size can be used as the 'input sample size' to weight the composition data to describe the relative information content of the data products being integrated in the stock assessment (e.g., catch, survey biomass, size-at-age, age and/or length composition). 
Due to the strong influence that compositional data can have in SCAA models, the weight assigned to these data products are important for providing accurate advice for management [e.g., @Hulson2012; @Xu2020].

The input sample size assigned to annual composition data can follow a myriad of methods (e.g., fixed values as in @Monnahan2021, number of samples or tows sampled upon as in @Hulson2021 or @Spencer2022, bootstrapping compositions as in @Stewart2014).
Data-weighting methods, to ensure congruence between the variance of the data and the variance implied by the model [@Francis2017], are used to check the fit of compositional data. 
The primary consideration when assigning a weight to composition data is to account for the potential variability and correlation in the sampling process. 
The method developed by @Stewart2014 allows for resampling techniques to be employed at each level of the sampling design, and provides an objective avenue to determine input sample size that is based on the observation variability contained within the sampling process. 

In addition to the traditional sources of intra-haul, measurement and observation uncertainty in age composition data, for every fish species sampled for which age is capable of being determined from otoliths there is resulting variability in the ageing of the otolith, often called 'ageing error' [e.g., @Punt2008]. 
There are a number of factors that can influence the magnitude of ageing error [@Nesslage2022], but inherent to obtaining ages from otoliths is variability in the age readings across the laboratory age readers. 
To account for this source of variability, ageing laboratories regularly evaluate precision through obtaining multiple readings of the same otolith across different age readers [@Morison2005]. 
Several methods have been developed to account for ageing error in SCAA models when fitting age composition through the use of an ageing error matrix [@Candy2012; @Punt2008]. 
The essence of this approach is that the numbers-at-age estimated by the assessment model are 'corrected' through multiplication with an ageing error matrix, which assigns estimated numbers-at-age to adjacent age-classes depending on the magnitude of the ageing error within the specific age-class. 
Since the development and implementation of ageing error matrices a number of studies have been devoted to quantifying the effects of ageing error on assessment model estimates [e.g., @Henriquez2016, @Liao2013]. 
Within each of these studies, and in each application of an ageing error matrix within a stock assessment model, the age composition data fit will be weighted by an input sample size. 
As described previously, the input sample size selected would reflect the variability in the sampling process, which should also include the variability in the age readings themselves. 

In the process of compositional expansion, it is often the case that an age-length key (ALK) is employed to expand population numbers-at-length to population numbers-at-age [@QuinnDeriso1999; @Ailloud2019]. 
It is through the ALK, and the subsequent age expansion, that observations of age composition are derived from fishery-independent and fishery-dependent sources. 
Conditional age-at-length (CAAL), in which paired age-length data are used as an indication of the age distribution for a specific length, is used to inform length-at-age and it's related uncertainty [@Taylor2013]. 
CAAL data can be used directly within SCAA models to inform estimates of growth as well as composition data [@Lee2019] and has been implemented in a number of operational stock assessments [e.g., @Mcgilliard2019; @Hulson2022]. 
An intrinsic component to both the ALK and CAAL is the variability in length for a given age.
Further, when using CAAL data as an additional likelihood component to a SCAA model one must determine the input sample size to be used to weight this information.

Despite the acceptance of requiring an input sample size to weight age composition data in SCAA models that reflects the added uncertainty caused by overdispersion common to age sampling, and the recognition of the inherent variability in the ageing process when reading otoliths and in the growth process upon which age-length keys are based, these sources of uncertainty have not been previously integrated in an objective estimation method for input sample size. 
In this study, we extend the methods of @Stewart2014 to estimate age composition input sample size that includes both ageing error and growth variability in the estimation process. 
We show, in a step-wise process, the added variability in age composition sample size from including ageing error and growth variability across a number of species that reflect differing life histories and levels of ageing difficulty. 

# Methods

## Data
We used historical data collected from bottom trawl surveys conducted by the Alaska Fisheries Science Center (AFSC) in the Eastern Bering Sea [EBS: @Lauth2019], Aleutian Islands [AI: @vonSzalay2017], and Gulf of Alaska [GOA: @vonSzalay2018]. 
Within the AFSC bottom trawl surveys both length frequency data and age specimen data are collected in addition to other survey data (e.g., catch, effort, location). 
Generally, a subsample of fish from each haul were processed at sea to collect their sex, length, and weight. 
A subsample of these fish have their sagittal otoliths collected, these otoliths were sent (with haul and specimen data) to the AFSC Age and Growth laboratory for age determination. 
Periodically, a subset of aged otoliths are selected for reader-tester agreement tests.
These tests are used to evaluate the reproducability of an age reading when two different readers age the same fish without knowledge of the other reader's age determination of the otolith [@Kimura1991]. 
The average annual bottom trawl survey age sample sizes by region, and the total number of otoliths used for reader-tester agreement tests are shown in Table \@ref(tab:species-samples)) for the species evaluated.
The species or stocks selected for this analysis all have greater than 5,000 reader-tester paired otolith readings.
These stocks are all assessed using integrated SCAA models that require input sample sizes for the age composition data. 
Details of how the length frequency and age collections are expanded to population abundance-at-length and -age then subsequently used as compositional data in stock assessment models at AFSC are provided in @Hulson2023b. 

## Simulation-Bootstrap framework
To evaluate the effect of the inclusion of ageing error and growth variability on uncertainty in age compostion datasets we modified a bootstrap-simulation framework [@Hulson2023b] to include these additional sources of error.
In simple terms, the simulation framework is a two-stage bootstrap that first resamples hauls, then resamples lengths and ages collected within the resampled hauls following from the methods in @Stewart2014. 
The simulation framework was modified to account for ageing error by resampling from tester ages associated with a given reader age. 
Growth variability was incorporated, for each species, by resampling fom all lengths associated with a given age and sex.

The order of operations (Figure \@ref(fig:bs-flows) has the following schedule:

1.  Resample hauls from the set of hauls with associated catch per unit effort (in numbers)
2.  Within the resampled hauls from step 1, resample the observed lengths
3.  With the resampled length frequency data from step 2, calculate population abundance-at-length
4.  Within the resampled hauls from step 1, resample the observed ages from the specimen data
5.  For the resampled ages in step 4, resample a length from the set of lengths observed for the given age
6.  For the resampled ages in step 4, resample an age from the set of tester ages for the given age
7.  With the resampled age data in steps 4-6 and the population abundance-at-length in step 3, calculate the population abundance-at-age

Steps 5 and 6 were designed to explore inclusion of ageing error and growth variability.
The bootstrap-simulation repeats steps 1-7 iteratively providing iterated population abundance-at-age for comparison to the historical (the full sample without any resampling of data) population abundance-at-age.

We applied the bootstrap-simulation in a step-wise manner to evaluate the consequences of adding each source of additional error to the age composition estimates across what we term 'uncertainty scenarios'.
First, we ran the bootstrap-simulation with the historical data without adding any extra error, thus, omitting steps 5 and 6 above ('Base' scenario). 
Next, we added ageing error ('AE' scenario) and growth variability ('GV' scenario) separately, thus, omitting either step 5 or 6 depending on the source of uncertainty desired.
Finally, we added both ageing error and growth variability ('AE & GV' scenario) to the bootstrap-simulation framework.
To increase reader-tester sample sizes for each species, we pooled reader-tester data across the three regions (we note that age readings for all three regions are produced in the same age reading laboratory at AFSC).
Sex-specific age-length pairs were pooled across all survey years, by region, in order to evaluate the maximum influence of growth variability on the replicated sex-specific age composition estimates.
The bootstrap-simulations were run for 500 iterations, a level at which the variability in population abundance-at-age results had stabilized.
The bootstrap-simulation was developed in R [@Rcore] and is available via GitHub as an R package (<https://github.com/BenWilliams-NOAA/surveyISS>).

## Computing input sample size

A useful statistic that can quantify the variability in age composition is relative sample size, introduced by @Mcallister1997.
This statistic evaluates the amount of uncertainty in an estimated composition compared to an observed composition and is given by:

\begin{equation}
 R_i=\frac{\sum_{c=1}^{C}E_{c,i}(1-E_{c,i})}{\sum_{c=1}^{C}(E_{c,i}-O_c)^2}
 (\#eq:eqn1)
\end{equation}
where $E_{c,i}$ is the estimated proportion for category-*c* (which can be age or any other arbitrary category across which proportions are computed) and $O_c$ is the observed proportion.
Here, the underlying age composition derived from the historical bottom trawl surveys with the full and unsampled data was treated as the observed proportions $O_c$ in equation \@ref(eq:eqn1).
For each iteration-*i* of the bootstrap-simulation we computed an estimated proportion ($E_{c,i}$) that was then compared to the underlying historical age composition ($O_c$) to determine the relative sample size ($R_i$) of the resampled age composition.
Thus, across each iteration of the bootstrap-simulation we computed a relative sample size that indicated the amount of uncertainty in the resampled age composition.

To summarize relative sample size across iterations we used the harmonic mean.
This has been shown to reduce bias in recovering the true sample size in simulations for a multinomial distribution and has also been recommended to determine the input sample size (ISS) that is used in stock assessment models to fit compositional data [@Stewart2014].
While we present the results of the annual ISS for each stock evaluated when incorporating ageing error, growth variability, or both, we also compute the proportion of 'base' ISS in order to present the relative decrease in ISS when incorporating these sources of additional uncertainty.
The 'relative ISS' is computed by dividing the ISS as determined after incorporating ageing error, growth variability, or both, by the base ISS without these sources of uncertainty.

## Evaluating life-history relationships to consequences of added uncertainty

Trends across stocks were aggregated and evaluated using three species types: flatfish (arrowtooth flounder, flathead sole, northern rock sole, and yellowfin sole), gadids (walleye pollock and Pacific cod), and rockfish (Pacific ocean perch and northern rockfish).
Two statistics were used to evaluate trends across the cases that added ageing error and growth variability.
The first statistic we used to evaluate the influence of adding ageing error was the average coefficient of variation (CV) in age agreement.
We computed this by computing the CV in the tester ages for a given reader age, then averaged these CVs across the reader ages.
The second statistic we used to evaluate the influence of adding growth variability was the average CV in age-length data.
We computed the average age-length CV by computing the CV in length for a given age, then averaging the CVs in length-at-age across age.

# Results

While the magnitude of age composition ISS was stock and region specific, the general result that was consistent across the stocks evaluated was a reduction in age composition ISS as additional sources of uncertainty were introduced in the bootstrap procedure (Figure \@ref(fig:iss-plot)).
This reduction in age composition ISS resulted for both sex-specific and total (combined sex) age composition ISS.
The relative magnitude of adding ageing error compared to growth variability was also stock and region specific.
For example, adding ageing error to arrowtooth flounder age data resulted in smaller ISS than adding growth variability in the GOA, but larger ISS in the EBS.
Variability in the age composition ISS across the scenarios evaluated was also stock and region specific, with Pacific cod and walleye pollock in the EBS having the greatest reduction in ISS and AI Atka mackerel having the least.

The age composition relative ISS across uncertainty scenarios revealed patterns across species types within each region evaluated (Figure \@ref(fig:prop-iss)).
Including ageing error for rockfish had a larger proportional reduction in relative ISS than including growth variability.
However, growth variability had a larger proportional reduction for flatfish and gadid relative ISS than adding ageing error.
Flatfish exhibited the greatest variability in the proportional reduction in relative ISS in any given region, while gadids had the smallest relative ISS, in general.
For example, after adding ageing error and growth variability the relative ISS for gadid was 85-95% in the AI, 40-50% in the EBS, and 70-80% in the GOA (Figure \@ref(fig:prop-iss)).
Overall, adding both ageing error and growth variability decreased the relative ISS to 50-90% of the Base ISS for flatfish, 40-90% for gadids, and 80-95% for rockfish.

<!-- For each of the uncertainty scenarios investigated the relationship between age composition ISS and the number of sampled hauls was not one-to-one for any of the species type evaluated (Figure \@ref(fig:iss-hls)). -->
<!-- It was also the case that across the uncertainty scenarios investigated there was large variability in the age composition ISS compared to the number of sampled hauls for each species type evaluated, and any trend was difficult to distinguish. -->
<!-- While an increasing trend resulted for rockfish and flatfish between age composition ISS and the number of sample hauls when fitting a linear model to the data, it was generally the case that the age composition ISS was larger than the number of sampled hauls for hauls less than 100-200, and smaller than the number of hauls for hauls larger than 100-200. -->
<!-- This increasing trend for rockfish and flatfish degraded as additional sources of uncertainty were added, but for each uncertainty case the trend was not one-to-one. -->
<!-- In each of the uncertainty scenarios investigated the trend between age composition ISS and the number of hauls for gadids was different than that for rockfish and flatfish, and while there was a slight increase in age composition ISS as the number of hauls increased, it was not as large of an increase as that which resulted for rockfish and flatfish. -->

<!-- The relationship between age composition ISS and the number of sampled hauls was not one-to-one for any of the species type evaluated (Figure \@ref(fig:iss-hls)). -->
<!-- Further, across uncertainty scenarios, there was large variability in the ISS compared to the number of sampled hauls for each species type evaluated, no clear pattern or trend was distinguishable. -->
<!-- While an increasing trend resulted for rockfish and flatfish between age composition ISS and the number of sample hauls when fitting a linear model to the data, it was generally the case that the age composition ISS was larger than the number of sampled hauls for hauls less than 100-200, and smaller than the number of hauls for hauls larger than 100-200. **Flag - May want to revisit some of this?**  -->
<!-- This increasing trend for rockfish and flatfish degraded as additional sources of uncertainty were added, but for each uncertainty case the trend was not one-to-one. -->
<!-- In each of the uncertainty scenarios investigated the trend between age composition ISS and the number of hauls for gadids was different than that for rockfish and flatfish, and while there was a slight increase in age composition ISS as the number of hauls increased, it was not as large of an increase as that which resulted for rockfish and flatfish. -->

A positive relationship is observed, by species group, between the number of age samples taken per haul and the age composition ISS per sampled haul (top panel of Figure \@ref(fig:iss-nss-hls)).
However, as sources of uncertainty were added to age data this positive trend was dampened for each species type; this was particularly true for gadids as compared to flatfish and rockfish.
Across species types the age composition ISS per haul was around half of the number of sampled ages per haul, less for rockfish and gadids.
The age composition ISS per haul was, on average, the largest for flatfish, followed by rockfish, and was the smallest for gadids (bottom panel of Figure \@ref(fig:iss-nss-hls)).
The variability in the age composition ISS per haul across years, regions, and sex categories was also the largest for flatfish compared to gadids and rockfish.

Comparing between statistics for ageing error and growth variability resulted in different trends in the relative ISS by species types (top panels of Figure \@ref(fig:ae-gv-stats)).
The relative ISS when adding ageing error was similar when compared to the average reader-tester CV between gadids and rockfish, with lower variability for rockfish (top left panel of Figure \@ref(fig:ae-gv-stats)).
While the range in average reader-tester CV was smaller for rockfish and gadids than for flatfish, the resulting range in relative ISS was larger for gadids than rockfish or flatfish.
The relative ISS when adding growth variability resulted in the smallest range in both ISS reduction and average age-length CV for rockfish, though flatfish and gadid had a larger CV spread (top right panel of Figure \@ref(fig:ae-gv-stats)).
On average, the relative ISS when adding both ageing error and growth variability was largest for rockfish, intermediate for flatfish, and smallest for gadids (bottom panel of Figure \@ref(fig:ae-gv-stats)).
The same trend resulted when evaluating the range in the relative ISS when both ageing error and growth variability were added.

# Discussion

In this study we found that adding sources of uncertainty that account for ageing error and growth variability in bootstrap procedures decreased age composition ISS for all stocks included in this analysis.
The impact of the sources of uncertainty on resulting ISS was species type specific, where ageing error was more influential for rockfish than growth variability, and growth variability was more infleuntial than ageing error for flatfish and gadids.
We propose that these results are due to larger growth variability found in gadids and flatfish compared to rockfish.
Further, the effects of ageing error are not surprising for rockfish, since they are so long-lived, but the average CV for reader-tester agreement was much larger for some flatfish stocks as compared to the rockfish stocks evaluated, thus, there was some interaction between the number of age bins and ISS in this analysis.
Upon adding both sources of uncertainty, generally the largest effect on reduction in ISS magnitude resulted for gadids, was intermediate for flatfish, and had the least effect on rockfish, but was stock and region specific.

Understanding effects of survey reduction effort has recently been the focus of a number of studies [@ICES2020; @ICES2023], as survey reductions may be inevitable in many regions.
A recent study investigated the reductions in length frequency and age collection effort, using AFSC bottom trawl survey as example [@Hulson2023c] and found that reduction in age collections had larger effect on flatfish and rockfish as compared to gadids.
Here we find that including additional sources of uncertainty has largest effect on gadids, and smallest on rockfish, and it is potentially the case that the effect of decreases in sampling effort for gadids and flatfish would be smaller given the magnitude of effect by these sources of uncertainty as compared to rockfish.
However, we acknowledge that this should be evaluated in future studies to understand the specific effects on stocks and when comparing among species types.

It is well known that misspecification of ISS when fitting compositional data can lead to bias results in assessment model predictions [e.g., @Stewart2017; @Xu2020].
Here we show for gadids that there is upwards of a 50% decrease in ISS for some stocks when adding additional uncertainty as compared to the base case, an upwards of 40% decrease for flatfish, and an upwards of 20% decrease for rockfish.
Without these additional sources of uncertainty taken into account, using the bootstrap procedure would result in ISS that are larger than what they should be.
While we did not investigate implications to specific assessment model outcomes, it can be inferred that reductions of ISS on this scale would have downstream effects on model predictions and the associated uncertainty.
We note that these sources of uncertainty would not be contained only to fishery-independent sources, like evaluated here, but would also be inherent to age collections for fishery-dependent sources as well.
Thus, future investigations into the impacts of adding ageing error and growth variability into ISS estimation on assessment model results should also include fishery-dependent ISS implications as well.

A number of operational assessment models use hauls as a proxy in some form when setting ISS for age and length composition data [e.g., @Barbeaux2022, @Hulson2021].
This is derived from a result found in @Pennington2002 who investigated length frequency sampling and, based on the level of intra-haul correlation, determined that for the species that were investigated, on average, the ISS was one fish per haul
However, we note that the conclusion made in @Pennington2002 was not that the number of hauls should be used as a proxy for ISS in the assessment model data fitting procedure, but rather, that in order to potentially increase the ISS and have a better estimate of the level of intra-haul correlation that samples should be taken from an increased number of hauls.
This result was further substantiated in @Siskey2022, who also suggested that increasing the number of hauls while decreasing the sampling effort on any given haul was preferable to increasing the sampling effort within any given haul at the expense of sampling from a greater number of hauls.

In this study, we find that the relationship between age composition ISS and the number of hauls to be extremely weak, if non-existent.
While the magnitude of ISS and the number of sampled hauls is on a similar relative magnitude scale, there was not a one-to-one relationship that resulted for any of the stocks or species types evaluated.
Further, we found that there was extreme variability when comparing between the number of sampled hauls and the resulting bootstrapped ISS for all of the uncertainty scenarios investigated here, and only became worse as the additional uncertainty sources were added to the bootstrap.
Compared to the bootstrap results, it was found that for all the species types evaluated, that if hauls were used as a proxy for ISS in an assessment model the ISS would be an underestimate for sampled hauls less than around 100, and an overestimate for hauls greater than around 100.
It is the case that, based on the results of @Pennington2002, that sampling effort at AFSC has transitioned to sampling an increased number of hauls rather than increasing sampling in any given haul, thus, in recent time-series using hauls as a proxy for ISS is likely an over-estimate of ISS as compared to the bootstrap results.

There are several advantages to using the bootstrap procedure introduced here, that follows from @Stewart2014, to determine ISS for composition data used in stock assessment models.
The primary advantage is that this procedure accounts for the sampling design employed to collect data, and thus, implicitly includes the inter annual heterogeneity in sampling effort.
One could argue that the number of sampled hauls can be used as a proxy for this heterogeneity in sampling effort, and we would agree, but also add that the number of hauls itself does not account for the inter annual heterogeneity in intra-haul correlation, which can be large and based on the changes in population demographics (i.e., large recruitment events or changes in composition structure from year to year).
Thus, we recommend that the use of hauls as a proxy for ISS be discontinued when using stock assessment models to fit age and length composition data, and rather, assessment scientists consider implementing a bootstrap procedure as shown here to use for setting ISS.
As suggested in @Stewart2014, we agree that the bootstrap ISS can be used in a stock assessment model as the 'maximum' sample size.

Previous work has investigated both the inclusion of ageing error [@Punt2008; @Liao2013] and growth [@Taylor2013] within stock assessment models, however, none have applied these additional sources of uncertainty in the context of estimating ISS.
As it pertains to ageing error, in many current assessments an ageing error matrix is implemented [e.g., @Williams2022] in order to account for ageing error that is inherent to the age composition data.
Use of an ageing error matrix effectively 'smudges' assessment model estimates of population-at-age into adjacent age classes prior to fitting the 'observed' age composition input data from either fishery-independent or fishery-dependent sources.
Then, in the model fitting step, an ISS is used to fit the models 'smudged' estimates of age composition to the 'observed' age composition.
Here we argue that unless ageing error is accounted for in the age composition ISS used to fit these data then we are likely 'over-fitting' the model estimates to the 'observed' age composition and that the use of only an ageing error matrix half-way accounts for this source of uncertainty in the assessment modeling process.
The results from this study suggest that in some cases the addition of ageing error to the bootstrap method decreases the age composition ISS by 20-40%, thus, an ISS that does not take into account this source of uncertainty can be 125-165% too large.

It is commonly the case that age composition is produced through a two-stage expansion process [@QuinnDeriso1999], in which length frequency data is expanded to population-at-length in the first stage, and an ALK is used to expand population-at-length to population-at-age in the second stage [@Ailloud2019].
In the second-stage of this expansion process, the ALK is produced through the use of age-length paired data that are obtained in the age sampling collection, and within the ALK the variability in length-at-age is implicitly accounted for.
However, there have been no previous attempts to include this source of variability when considering the ISS that is used to fit the expanded age composition data.
We find that the magnitude of effect on age composition ISS is species type dependent, in which a larger effect results for species that exhibit larger variability in growth, for example, gadids and flatfish compared to rockfish.
When implementing growth variability there was a 10-50% decrease in the magnitude of bootstrapped age composition ISS, thus, if not taking this source of uncertainty into account the ISS can be up to 200% too large.

Overall, we find that including ageing error and growth variability into estimation of age composition ISS can have large effect in reducing the magnitude of ISS.
We provide three primary recommendations from this work.
First, we recommend that the use of hauls as a proxy for age or length composition ISS in stock assessment models be discontinued.
While we found that the scale of age composition ISS and hauls were similar, we did not find any relationship between the bootstrap ISS and hauls for any species that would suggest using hauls as a proxy, rather, we found that using hauls will likely lead to either an over- or under-estimation of ISS, with the former potentially having greater implications to model results [@Francis2011].
Second, we recommend that stock assessment scientists consider the use of bootstrap methods like this one [which was developed from @Stewart2017] to set and and length composition ISS.
With modern computing power, for a single species using the package we built (<https://github.com/BenWilliams-NOAA/surveyISS>) it takes on the matter of a couple of hours to obtain both age and length composition bootstrap ISS for a historical survey time series (longer than 40 years in some cases); for a single year it takes a matter of minutes.
Third, for all estimates of age composition ISS we recommend implementing ageing error and growth variability to more explicitly and thoroughly take these sources of uncertainty into account in stock assessment models.
We note that while we used fishery-independent data here as an example, that these sources of uncertainty would also be inherent to fishery-dependent data.

# Acknowledgments

We thank *reviewer1* and *reviewer2* for their helpful reviews of this manuscript. We also thank all the AFSC survey staff who collected the data over the last 40 years used in this analysis.

\newpage

# Citations

::: {#refs}
:::

\newpage

# Tables

```{r species-sample}
knitr::kable(vroom::vroom(here::here('tables', 'species_sample.csv')), 
             caption = "Average age samples from the AFSC bottom trawl surveys by region (rounded to the nearest 10), and total reader-tester age pairs (rounded to the nearest 100) for the species evaluated in the bootstrap-simulation.", 
             align = c('llcccc'), format.args = list(big.mark = ",", scientific = FALSE))
```

\newpage

# Figures

```{r bs-flows, fig.cap="Bootstrap-simulation flow chart, the steps refer to the order of operations."}
knitr::include_graphics(here::here('figs', 'age_flowchart.png'))
```

```{r iss-plot, fig.cap="Age composition input sample size for the stocks and regions evaluated across uncertainty scenarios."}
knitr::include_graphics(here::here('figs', 'alt_iss.png'))
```

```{r prop-iss, fig.cap="Age composition relative input sample size by species type across sex categories and uncertainty scenarios."}
knitr::include_graphics(here::here('figs', 'alt_prop-iss.png'))
```

```{r iss-nss-hls, fig.cap="Age composition input sample size per sampled haul compared to number ages sampled within a haul (top panel) across uncertainty scenarios and species types (bottom panel)."}
knitr::include_graphics(here::here('figs', 'alt_hls-iss-nss.png'))
```

```{r ae-gv-stats, fig.cap="Age composition relative input sample size compared to age and growth statistics (top panel) and across stocks evaluated (bottom panel)."}
knitr::include_graphics(here::here('figs', 'alt_ae-gv-stats.png'))
```
